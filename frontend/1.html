<!DOCTYPE html>
<html>
<head>
  <title>Multiple File Upload with Management</title>
  <style>
    .file-item {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
    }

    .file-item span {
      flex-grow: 1;
    }

    .file-item button {
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <input type="file" id="fileInput" multiple hidden>
  <button id="addFilesButton">添加文件</button>

  <div id="selectedFiles"></div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const addFilesButton = document.getElementById('addFilesButton');
    const selectedFilesDiv = document.getElementById('selectedFiles');

    let selectedFileList = []; // 用于存储已选择的文件
    displaySelectedFiles();

    // 处理添加文件按钮点击事件
    addFilesButton.addEventListener('click', () => {
      fileInput.click(); // 触发文件选择对话框
    });

    // 处理文件选择事件
    fileInput.addEventListener('change', (event) => {
      const newFiles = Array.from(event.target.files); // 将 FileList 转换为数组

      // 将新选择的文件添加到已选择的文件列表中 (避免重复)
      newFiles.forEach(newFile => {
        if (!selectedFileList.some(existingFile => existingFile.name === newFile.name && existingFile.size === newFile.size && existingFile.type === newFile.type)) {
          selectedFileList.push(newFile);
        }
      });

      displaySelectedFiles(); // 更新显示
      fileInput.value = null; // 清空 fileInput 的 value，以便可以选择相同的文件
    });

    // 显示已选择的文件
    function displaySelectedFiles() {
      selectedFilesDiv.innerHTML = ''; // 清空之前的列表

      if (selectedFileList.length === 0) {
        selectedFilesDiv.textContent = '未选择任何文件。';
        return;
      }

      selectedFileList.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.classList.add('file-item');

        const fileNameSpan = document.createElement('span');
        fileNameSpan.textContent = file.name;

        const removeButton = document.createElement('button');
        removeButton.textContent = '移除';
        removeButton.addEventListener('click', () => {
          // 移除文件
          selectedFileList.splice(index, 1);
          displaySelectedFiles(); // 更新显示
        });

        fileItem.appendChild(fileNameSpan);
        fileItem.appendChild(removeButton);
        selectedFilesDiv.appendChild(fileItem);
      });
    }
  </script>
</body>
</html>
